import A from"./Master-60d43cc0.js";import{s as v}from"./multiselect-f2892036.js";import{_ as F,r as g,o as c,c as n,b as e,t,d as f,F as m,g as h,j as b,e as V,h as N}from"./app-1a426ef4.js";const x={layout:A,components:{Multiselect:v},props:["referral","transactions"],data(){return{selectedYear:new Date().getFullYear(),selectedMonth:new Date().getMonth()+1,years:Array.from({length:10},(o,l)=>new Date().getFullYear()-l),months:[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],selectedVisa:{},showModal:!1,FamilyNetAmount:0,FamilytotalVisaFee:0,totalReferralAmount:0}},watch:{transactions:{handler(o){console.log("Updated transactions:",o)},deep:!0,immediate:!0}},computed:{combinedTransactions(){return this.transactions.map(o=>{var i,u,s;let l=(i=o.visa)==null?void 0:i.date;if(!l||l.trim()===""){const _=new Date;l=`${_.getFullYear()}-${(_.getMonth()+1).toString().padStart(2,"0")}-01`}const r=new Date(l),d=r.getFullYear(),a=r.getMonth()+1;return{...o,date:l,entry_type:((u=o.visa)==null?void 0:u.entry_type)||"",family_members:((s=o.visa)==null?void 0:s.entry_type)==="Family"?o.visa.familyMembers:[],year:d,month:a}}).filter(o=>o.year===this.selectedYear&&o.month===this.selectedMonth)},totalActualAmount(){return this.combinedTransactions.reduce((o,l)=>o+parseFloat(l.cash_in||0),0).toFixed(2)},totalNetAmount(){return this.combinedTransactions.reduce((o,l)=>o+this.calculateNetAmount(l),0).toFixed(2)},totalAmountReceived(){return this.combinedTransactions.reduce((o,l)=>o+this.calculateAmountAfterCommission(l),0).toFixed(2)}},methods:{calculateReferralAmount(o){let l=parseFloat(this.FamilyNetAmount)||0,r=o.referral_commission?parseFloat(o.referral_commission.replace("%","")):0;if(isNaN(r)||r<=0)return console.log("Invalid Referral Commission:",r),"0.00";let d=l*r/100;return console.log("Referral Amount Calculated:",d),d.toFixed(2)},openModal(o){console.log("Opening modal for:",o),this.selectedVisa={...o.visa,familyMembers:o.familyMembers||[]},new bootstrap.Modal(document.getElementById("visaModal")).show()},calculateNetAmount(o){var d;const l=parseFloat(o.cash_in||0),r=parseFloat(((d=o.visa)==null?void 0:d.visa_fee)||0);return l-r},sumFamilyActualAmount(o,l){let r=parseFloat(o)||0;return Array.isArray(l)&&l.length>0&&(r+=l.reduce((d,a)=>{let i=parseFloat(a.amount)||0;return d+i},0)),console.log("Total Family Actual Amount:",r),r.toFixed(2)},sumFamilyVisaFeeAmount(o,l){let r=Number(o==null?void 0:o.visa_fee)||0;return Array.isArray(l)&&(r+=l.reduce((d,a)=>d+(Number(a.visa_fee)||0),0)),this.FamilytotalVisaFee=r,r},calculateFamilyNetAmount(o,l){let r=parseFloat(o)||0,d=parseFloat(l)||0;return this.FamilyNetAmount=Math.abs(r-d),console.log("Family Net Amount:",this.FamilyNetAmount),this.FamilyNetAmount.toFixed(2)},calculateAmountAfterCommission(o){var d;const l=this.calculateNetAmount(o),r=parseFloat(((d=o.referral_commission)==null?void 0:d.replace("%",""))||0);return l*r/100}},mounted(){console.log("Initial Transactions:",this.transactions)}},k={id:"main",class:"main"},M={class:"pagetitle d-flex justify-content-between"},w={class:"theme-text-color"},T=V('<nav><ol class="breadcrumb"><li class="breadcrumb-item"><a href="dashboard">TTC Global</a></li><li class="breadcrumb-item">Referral</li><li class="breadcrumb-item active">Details</li></ol></nav>',1),C={class:"section"},D={class:"card p-3"},R={class:"d-flex gap-2 align-items-center"},Y={class:"section"},S={class:"card"},I={class:"card-body"},j=e("h5",{class:"card-title theme-text-color"},"Transactions",-1),B={id:"ledgerTable",class:"table table-striped"},P=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"border p-2"},"Full Name"),e("th",{class:"border p-2"},"Phone"),e("th",{class:"border p-2"},"Tracking ID"),e("th",{class:"border p-2"},"Actual Amount"),e("th",{class:"border p-2"},"Net Amount"),e("th",{class:"border p-2"}," Amount Referral Will Receive ")])],-1),E=["onClick"],J={class:"text-success"},O=e("br",null,null,-1),U={key:0},G=e("br",null,null,-1),L={class:"border p-2"},W={class:"border p-2"},q={class:"border p-2"},z={key:0},H={key:1},K={class:"border p-2 text-green-600"},Q={key:0},X={key:1},Z={class:"border p-2 font-bold text-blue-600"},$={key:0},ee={key:1},te={class:"bg-gray-100 font-bold"},se=e("td",{class:"border p-2 text-center",colspan:"3"}," Total ",-1),oe={class:"border p-2"},le={class:"border p-2 text-green-600"},ae={class:"border p-2 text-blue-600"},re={class:"modal fade",id:"visaModal",tabindex:"-1","aria-labelledby":"modalTitle","aria-hidden":"true"},ce={class:"modal-dialog modal-lg"},ne={class:"modal-content"},de={class:"modal-header"},ie={class:"modal-title",id:"modalTitle"},_e=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ue={class:"modal-body"},me={class:"table table-striped"},he=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"#"),e("th",{class:"border p-2"},"Status"),e("th",{class:"border p-2"},"Date"),e("th",{class:"border p-2"},"Full Name"),e("th",{class:"border p-2"},"Phone Number"),e("th",{class:"border p-2"},"Amount"),e("th",{class:"border p-2"},"Visa Fee"),e("th",{class:"border p-2"},"Gender")])],-1),be={key:0},pe=e("td",{class:"border p-2"},"1",-1),ye={class:"border p-2"},fe={class:"border p-2"},Ae={class:"border p-2"},ve={class:"border p-2"},Fe={class:"border p-2"},ge={class:"border p-2"},Ve={class:"border p-2"},Ne={key:0},xe=e("td",{colspan:"7",class:"border p-2 text-center"}," No family members available ",-1),ke=[xe],Me={class:"border p-2"},we={class:"border p-2"},Te={class:"border p-2"},Ce={class:"border p-2"},De={class:"border p-2"},Re={class:"border p-2"},Ye={class:"border p-2"},Se={class:"border p-2"},Ie={key:1},je=e("td",{class:"border p-2"},"1",-1),Be={class:"border p-2"},Pe={class:"border p-2"},Ee={class:"border p-2"},Je={class:"border p-2"},Oe={class:"border p-2"},Ue={class:"border p-2"},Ge={class:"border p-2"},Le={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},We={class:"bg-white p-5 rounded-lg shadow-lg w-3/4"},qe=e("h2",{class:"text-lg font-bold mb-4"},"Family Visa Details",-1),ze={class:"table-auto w-full border-collapse border border-gray-300"},He=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"border p-2"},"#"),e("th",{class:"border p-2"},"Name"),e("th",{class:"border p-2"},"Phone"),e("th",{class:"border p-2"},"Tracking ID"),e("th",{class:"border p-2"},"Amount"),e("th",{class:"border p-2"},"Entry Type")])],-1),Ke={class:"border p-2"},Qe={class:"border p-2"},Xe={class:"border p-2"},Ze={class:"border p-2"},$e={class:"border p-2"},et={class:"border p-2"};function tt(o,l,r,d,a,i){const u=g("Multiselect");return c(),n("main",k,[e("div",M,[e("div",null,[e("h1",w,t(r.referral.name),1),T])]),e("section",C,[e("div",D,[e("div",R,[f(u,{modelValue:a.selectedYear,"onUpdate:modelValue":l[0]||(l[0]=s=>a.selectedYear=s),options:a.years,searchable:!0,placeholder:"Select Year"},null,8,["modelValue","options"]),f(u,{modelValue:a.selectedMonth,"onUpdate:modelValue":l[1]||(l[1]=s=>a.selectedMonth=s),options:a.months,searchable:!0,placeholder:"Select Month"},null,8,["modelValue","options"])])])]),e("section",Y,[e("div",S,[e("div",I,[j,e("table",B,[P,e("tbody",null,[(c(!0),n(m,null,h(i.combinedTransactions,(s,_)=>(c(),n("tr",{key:_,class:""},[e("td",null,[e("a",{href:"#",class:"theme-text-color",onClick:p=>i.openModal(s)},[e("b",J,t(s.entry_type)+" - Apply",1),O,e("b",null,"1 - "+t(s.visa.full_name),1),s.entry_type==="Family"?(c(),n("div",U,[(c(!0),n(m,null,h(s.familyMembers,(p,y)=>(c(),n("span",{key:y},[e("b",null,[N(t(y+1+1)+" - "+t(p.full_name),1),G])]))),128))])):b("",!0)],8,E)]),e("td",L,t(s.visa.phone_number),1),e("td",W,t(s.visa.tracking_id),1),e("td",q,[s.entry_type==="Family"?(c(),n("div",z,t(i.sumFamilyActualAmount(s.cash_in,s.familyMembers)),1)):(c(),n("div",H,t(s.cash_in||"-"),1))]),e("td",K,[s.entry_type==="Family"?(c(),n("div",Q,t(i.calculateFamilyNetAmount(i.sumFamilyVisaFeeAmount(s.visa,s.familyMembers),i.sumFamilyActualAmount(s.cash_in,s.familyMembers))),1)):(c(),n("div",X,t(i.calculateNetAmount(s)),1))]),e("td",Z,[s.entry_type==="Family"?(c(),n("div",$,t(i.calculateReferralAmount(s.referral_commission)),1)):(c(),n("div",ee,t(i.calculateAmountAfterCommission(s)),1))])]))),128))]),e("tfoot",te,[e("tr",null,[se,e("td",oe,t(i.totalActualAmount),1),e("td",le,t(i.totalNetAmount),1),e("td",ae,t(a.totalReferralAmount),1)])])])])])]),e("div",re,[e("div",ce,[e("div",ne,[e("div",de,[e("h5",ie,t(a.selectedVisa.family_name||a.selectedVisa.full_name)+" "+t(a.selectedVisa.phone_number),1),_e]),e("div",ue,[e("table",me,[he,a.selectedVisa.entry_type==="Family"?(c(),n("tbody",be,[e("tr",null,[pe,e("td",ye,t(a.selectedVisa.status),1),e("td",fe,t(a.selectedVisa.date),1),e("td",Ae,t(a.selectedVisa.full_name),1),e("td",ve,t(a.selectedVisa.phone_number),1),e("td",Fe,t(a.selectedVisa.amount||"N/A"),1),e("td",ge,t(a.selectedVisa.visa_fee),1),e("td",Ve,t(a.selectedVisa.gender),1)]),a.selectedVisa.familyMembers.length===0?(c(),n("tr",Ne,ke)):b("",!0),(c(!0),n(m,null,h(a.selectedVisa.familyMembers,(s,_)=>(c(),n("tr",{key:s.id},[e("td",Me,t(_+2),1),e("td",we,t(s.status),1),e("td",Te,t(s.date),1),e("td",Ce,t(s.full_name),1),e("td",De,t(s.phone_number),1),e("td",Re,t(s.amount||"N/A"),1),e("td",Ye,t(s.visa_fee),1),e("td",Se,t(s.gender),1)]))),128))])):(c(),n("tbody",Ie,[e("tr",null,[je,e("td",Be,t(a.selectedVisa.status),1),e("td",Pe,t(a.selectedVisa.date),1),e("td",Ee,t(a.selectedVisa.full_name),1),e("td",Je,t(a.selectedVisa.phone_number),1),e("td",Oe,t(a.selectedVisa.amount||"N/A"),1),e("td",Ue,t(a.selectedVisa.visa_fee),1),e("td",Ge,t(a.selectedVisa.gender),1)])]))])])])])]),a.showModal?(c(),n("div",Le,[e("div",We,[qe,e("table",ze,[He,e("tbody",null,[(c(!0),n(m,null,h(o.selectedFamilyRecords,(s,_)=>(c(),n("tr",{key:_},[e("td",Ke,t(_+1),1),e("td",Qe,t(s.full_name),1),e("td",Xe,t(s.phone_number),1),e("td",Ze,t(s.tracking_id),1),e("td",$e,t(s.amount||"N/A"),1),e("td",et,t(s.entry_type),1)]))),128))])]),e("button",{onClick:l[2]||(l[2]=s=>a.showModal=!1),class:"mt-4 bg-red-500 text-white px-4 py-2 rounded"}," Close ")])])):b("",!0)])}const at=F(x,[["render",tt]]);export{at as default};
