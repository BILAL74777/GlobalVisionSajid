import v from"./Master-ed50555a.js";import{s as A}from"./multiselect-b95c915c.js";import{_ as F,r as g,o as r,c,b as e,t as s,d as y,F as h,g as b,j as u,e as V,h as N}from"./app-bdb38541.js";const k={layout:v,components:{Multiselect:A},props:["referral","transactions"],data(){return{selectedYear:new Date().getFullYear(),selectedMonth:new Date().getMonth()+1,years:Array.from({length:10},(o,l)=>new Date().getFullYear()-l),months:[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],selectedVisa:{},showModal:!1,FamilyNetAmount:0,FamilytotalVisaFee:0,totalReferralAmount:0}},watch:{transactions:{handler(o){},deep:!0,immediate:!0}},computed:{combinedTransactions(){return this.transactions.map(o=>{var i,m,t;let l=(i=o.visa)==null?void 0:i.date;if(!l||l.trim()===""){const _=new Date;l=`${_.getFullYear()}-${(_.getMonth()+1).toString().padStart(2,"0")}-01`}const d=new Date(l),n=d.getFullYear(),a=d.getMonth()+1;return{...o,date:l,entry_type:((m=o.visa)==null?void 0:m.entry_type)||"",family_members:((t=o.visa)==null?void 0:t.entry_type)==="Family"?o.visa.familyMembers:[],year:n,month:a}}).filter(o=>o.year===this.selectedYear&&o.month===this.selectedMonth)},totalActualAmount(){return this.combinedTransactions.reduce((o,l)=>o+parseFloat(l.cash_in||0),0).toFixed(2)},totalNetAmount(){return this.combinedTransactions.reduce((o,l)=>o+this.calculateNetAmount(l),0).toFixed(2)},totalAmountReceived(){return this.combinedTransactions.reduce((o,l)=>o+this.calculateAmountAfterCommission(l),0).toFixed(2)}},methods:{calculateReferralAmount(o){let l=parseFloat(this.FamilyNetAmount)||0,d=o.referral_commission?parseFloat(o.referral_commission.replace("%","")):0;return isNaN(d)||d<=0?"0.00":(l*d/100).toFixed(2)},openModal(o){this.selectedVisa={...o.visa,familyMembers:o.familyMembers||[]},new bootstrap.Modal(document.getElementById("visaModal")).show()},calculateNetAmount(o){var n;const l=parseFloat(o.cash_in||0),d=parseFloat(((n=o.visa)==null?void 0:n.visa_fee)||0);return l-d},sumFamilyActualAmount(o,l){let d=parseFloat(o)||0;return Array.isArray(l)&&l.length>0&&(d+=l.reduce((n,a)=>{let i=parseFloat(a.amount)||0;return n+i},0)),d.toFixed(2)},sumFamilyVisaFeeAmount(o,l){let d=Number(o==null?void 0:o.visa_fee)||0;return Array.isArray(l)&&(d+=l.reduce((n,a)=>n+(Number(a.visa_fee)||0),0)),this.FamilytotalVisaFee=d,d},calculateFamilyNetAmount(o,l){let d=parseFloat(o)||0,n=parseFloat(l)||0;return this.FamilyNetAmount=Math.abs(d-n),this.FamilyNetAmount.toFixed(2)},calculateAmountAfterCommission(o){var n;const l=this.calculateNetAmount(o),d=parseFloat(((n=o.referral_commission)==null?void 0:n.replace("%",""))||0);return l*d/100}},mounted(){}},x={id:"main",class:"main"},M={class:"pagetitle d-flex justify-content-between"},w={class:"theme-text-color"},T=V('<nav><ol class="breadcrumb"><li class="breadcrumb-item"><a href="dashboard">TTC Global</a></li><li class="breadcrumb-item">Referral</li><li class="breadcrumb-item active">Details</li></ol></nav>',1),D={class:"section"},C={class:"card p-3"},Y={class:"d-flex gap-2 align-items-center"},R={class:"section"},S={class:"card"},j={class:"card-body"},B=e("h5",{class:"card-title theme-text-color"},"Transactions",-1),P={id:"ledgerTable",class:"table table-striped"},E=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"border p-2"},"Full Name"),e("th",{class:"border p-2"},"Phone"),e("th",{class:"border p-2"},"Tracking ID"),e("th",{class:"border p-2"},"Actual Amount"),e("th",{class:"border p-2"},"Net Amount"),e("th",{class:"border p-2"}," Amount Referral Will Receive ")])],-1),I=["onClick"],J={class:"text-success"},G=e("br",null,null,-1),O={key:0},U={key:1},L=e("br",null,null,-1),W={key:0,class:"border p-2"},q={key:1,class:"border p-2"},z={class:"border p-2"},H={key:0},K={key:1},Q={class:"border p-2 text-green-600"},X={key:0},Z={key:1},$={class:"border p-2 font-bold text-blue-600"},ee={key:0},te={key:1},se={class:"bg-gray-100 font-bold"},oe=e("td",{class:"border p-2 text-center",colspan:"3"}," Total ",-1),le={class:"border p-2"},ae={class:"border p-2 text-green-600"},re={class:"border p-2 text-blue-600"},ce={class:"modal fade",id:"visaModal",tabindex:"-1","aria-labelledby":"modalTitle","aria-hidden":"true"},de={class:"modal-dialog modal-lg"},ie={class:"modal-content"},ne={class:"modal-header"},_e={class:"modal-title",id:"modalTitle"},ue=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),me={class:"modal-body"},he={class:"table table-striped"},be=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"#"),e("th",{class:"border p-2"},"Status"),e("th",{class:"border p-2"},"Date"),e("th",{class:"border p-2"},"Full Name"),e("th",{class:"border p-2"},"Phone Number"),e("th",{class:"border p-2"},"Amount"),e("th",{class:"border p-2"},"Visa Fee"),e("th",{class:"border p-2"},"Gender")])],-1),pe={key:0},fe=e("td",{class:"border p-2"},"1",-1),ye={class:"border p-2"},ve={class:"border p-2"},Ae={class:"border p-2"},Fe={class:"border p-2"},ge={class:"border p-2"},Ve={class:"border p-2"},Ne={class:"border p-2"},ke={key:0},xe=e("td",{colspan:"7",class:"border p-2 text-center"}," No family members available ",-1),Me=[xe],we={class:"border p-2"},Te={class:"border p-2"},De={class:"border p-2"},Ce={class:"border p-2"},Ye={class:"border p-2"},Re={class:"border p-2"},Se={class:"border p-2"},je={class:"border p-2"},Be={key:1},Pe=e("td",{class:"border p-2"},"1",-1),Ee={class:"border p-2"},Ie={class:"border p-2"},Je={class:"border p-2"},Ge={class:"border p-2"},Oe={class:"border p-2"},Ue={class:"border p-2"},Le={class:"border p-2"},We={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},qe={class:"bg-white p-5 rounded-lg shadow-lg w-3/4"},ze=e("h2",{class:"text-lg font-bold mb-4"},"Family Visa Details",-1),He={class:"table-auto w-full border-collapse border border-gray-300"},Ke=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"border p-2"},"#"),e("th",{class:"border p-2"},"Name"),e("th",{class:"border p-2"},"Phone"),e("th",{class:"border p-2"},"Tracking ID"),e("th",{class:"border p-2"},"Amount"),e("th",{class:"border p-2"},"Entry Type")])],-1),Qe={class:"border p-2"},Xe={class:"border p-2"},Ze={class:"border p-2"},$e={class:"border p-2"},et={class:"border p-2"},tt={class:"border p-2"};function st(o,l,d,n,a,i){const m=g("Multiselect");return r(),c("main",x,[e("div",M,[e("div",null,[e("h1",w,s(d.referral.name),1),T])]),e("section",D,[e("div",C,[e("div",Y,[y(m,{modelValue:a.selectedYear,"onUpdate:modelValue":l[0]||(l[0]=t=>a.selectedYear=t),options:a.years,searchable:!0,placeholder:"Select Year"},null,8,["modelValue","options"]),y(m,{modelValue:a.selectedMonth,"onUpdate:modelValue":l[1]||(l[1]=t=>a.selectedMonth=t),options:a.months,searchable:!0,placeholder:"Select Month"},null,8,["modelValue","options"])])])]),e("section",R,[e("div",S,[e("div",j,[B,e("table",P,[E,e("tbody",null,[(r(!0),c(h,null,b(i.combinedTransactions,(t,_)=>(r(),c("tr",{key:_,class:""},[e("td",null,[e("a",{href:"#",class:"theme-text-color",onClick:p=>i.openModal(t)},[e("b",J,s(t.entry_type)+" - Apply",1),G,t&&t.visa&&t.visa.full_name?(r(),c("b",O,"1 - "+s(t.visa.full_name),1)):u("",!0),t.entry_type==="Family"?(r(),c("div",U,[(r(!0),c(h,null,b(t.familyMembers,(p,f)=>(r(),c("span",{key:f},[e("b",null,[N(s(f+1+1)+" - "+s(p.full_name??""),1),L])]))),128))])):u("",!0)],8,I)]),t&&t.visa&&t.visa.phone_number?(r(),c("td",W,s(t.visa.phone_number),1)):u("",!0),t&&t.visa&&t.visa.tracking_id?(r(),c("td",q,s(t.visa.tracking_id),1)):u("",!0),e("td",z,[t.entry_type==="Family"?(r(),c("div",H,s(i.sumFamilyActualAmount(t.cash_in,t.familyMembers)),1)):(r(),c("div",K,s(t.cash_in||"-"),1))]),e("td",Q,[t.entry_type==="Family"?(r(),c("div",X,s(i.calculateFamilyNetAmount(i.sumFamilyVisaFeeAmount(t.visa,t.familyMembers),i.sumFamilyActualAmount(t.cash_in,t.familyMembers))),1)):(r(),c("div",Z,s(i.calculateNetAmount(t)),1))]),e("td",$,[t.entry_type==="Family"?(r(),c("div",ee,s(i.calculateReferralAmount(t.referral_commission)),1)):(r(),c("div",te,s(i.calculateAmountAfterCommission(t)),1))])]))),128))]),e("tfoot",se,[e("tr",null,[oe,e("td",le,s(i.totalActualAmount),1),e("td",ae,s(i.totalNetAmount),1),e("td",re,s(a.totalReferralAmount),1)])])])])])]),e("div",ce,[e("div",de,[e("div",ie,[e("div",ne,[e("h5",_e,s(a.selectedVisa.family_name||a.selectedVisa.full_name)+" "+s(a.selectedVisa.phone_number),1),ue]),e("div",me,[e("table",he,[be,a.selectedVisa.entry_type==="Family"?(r(),c("tbody",pe,[e("tr",null,[fe,e("td",ye,s(a.selectedVisa.status),1),e("td",ve,s(a.selectedVisa.date),1),e("td",Ae,s(a.selectedVisa.full_name),1),e("td",Fe,s(a.selectedVisa.phone_number),1),e("td",ge,s(a.selectedVisa.amount||"N/A"),1),e("td",Ve,s(a.selectedVisa.visa_fee),1),e("td",Ne,s(a.selectedVisa.gender),1)]),a.selectedVisa.familyMembers.length===0?(r(),c("tr",ke,Me)):u("",!0),(r(!0),c(h,null,b(a.selectedVisa.familyMembers,(t,_)=>(r(),c("tr",{key:t.id},[e("td",we,s(_+2),1),e("td",Te,s(t.status),1),e("td",De,s(t.date),1),e("td",Ce,s(t.full_name),1),e("td",Ye,s(t.phone_number),1),e("td",Re,s(t.amount||"N/A"),1),e("td",Se,s(t.visa_fee),1),e("td",je,s(t.gender),1)]))),128))])):(r(),c("tbody",Be,[e("tr",null,[Pe,e("td",Ee,s(a.selectedVisa.status),1),e("td",Ie,s(a.selectedVisa.date),1),e("td",Je,s(a.selectedVisa.full_name),1),e("td",Ge,s(a.selectedVisa.phone_number),1),e("td",Oe,s(a.selectedVisa.amount||"N/A"),1),e("td",Ue,s(a.selectedVisa.visa_fee),1),e("td",Le,s(a.selectedVisa.gender),1)])]))])])])])]),a.showModal?(r(),c("div",We,[e("div",qe,[ze,e("table",He,[Ke,e("tbody",null,[(r(!0),c(h,null,b(o.selectedFamilyRecords,(t,_)=>(r(),c("tr",{key:_},[e("td",Qe,s(_+1),1),e("td",Xe,s(t.full_name),1),e("td",Ze,s(t.phone_number),1),e("td",$e,s(t.tracking_id),1),e("td",et,s(t.amount||"N/A"),1),e("td",tt,s(t.entry_type),1)]))),128))])]),e("button",{onClick:l[2]||(l[2]=t=>a.showModal=!1),class:"mt-4 bg-red-500 text-white px-4 py-2 rounded"}," Close ")])])):u("",!0)])}const rt=F(k,[["render",st]]);export{rt as default};
